script: |
  source recruiter-curl.sh
  curl -X POST -d '{"addr":"a.b.c:5000","node_name":"a.b","timeout":1}' \
    http://$ZQD_HOST/recruiter/register 2> err
  curl -X POST -d '{"addr":"a.b.c:5000","node_name":"a.b","timeout":30000}' \
    http://$ZQD_HOST/recruiter/register 2> err &   
  # This is intentionally backgrounded. The 100ms sleep allows the registration.
  sleep 0.1
  curl http://$ZQD_HOST/recruiter/stats 2> err
  curl http://$ZQD_HOST/recruiter/listfree 2> err
  # This /recruit call will cause the backgrounded /register to return
  # and print it's output.
  curl -X POST -d '{"number_requested":1}' http://$ZQD_HOST/recruiter/recruit 2> err
  curl -request GET http://$ZQD_HOST/recruiter/stats 2> err
  curl http://$ZQD_HOST/recruiter/listfree 2> err

inputs:
  - name: recruiter-curl.sh
    source: recruiter-curl.sh

outputs:
  - name: stdout
    data: |
      {"directive":"reregister"}
      {"len_free_pool":1,"len_reserved_pool":0,"len_node_pool":1}
      {
        "workers": [
          {
            "addr": "a.b.c:5000",
            "node_name": "a.b"
          }
        ]
      }
      {"workers":[{"addr":"a.b.c:5000","node_name":"a.b"}]}
      {"directive":"reserved"}
      {"len_free_pool":0,"len_reserved_pool":1,"len_node_pool":0}
      {
        "workers": []
      }
